CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 1   


CX51 COMPILER V7.50, COMPILATION OF MODULE SYSPARAMSET
OBJECT MODULE PLACED IN SysParamSet.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\CX51.EXE SysParamSet.c LARGE OBJECTADVANCED ROM(HUGE) OPTIMIZE(SIZE) BROWSE DEBUG

line level    source

   1          #define SYSPARAM_C
   2          #include "device.h"
   3          #include "global.h"
   4          #include "scheduler.h"
   5          #include "CommonFunction.h"
   6          #include "STRING.h"
   7          #include "SysParamSet.h"
   8          #include "key.h"
   9          #include "common.h"
  10          #include "mainflow.h"
  11          #include "debug.h"
  12          #include "VMC_PC.h"
  13          
  14          
  15          //#undef _DEBUG_TRACE
  16          /***********************************/
  17          #ifdef _CHINA_
  18                  const struct StrAndLen code SysMenustr[] =
  19                  {       
  20                          /*
  21                          { "1.#1找零器面值:", 15 },      
  22                          { "2.#2找零器面值:", 15 },              
  23                          //{ "3.#3找零器面值:", 15 }, //111024 by cq 删除
  24                          { "3.允许多次购买:", 15 },
  25                          { "4.不买货退币:", 13 },
  26                          { "5.开启纸币器:", 13 },        
  27                          //{ "7.开启手机模块:", 15 },     //111024 by cq 删除
  28                  { "6.余额下限:", 11 },
  29                  { "7.收币上限:", 11 },  
  30                  //最后一次纸币有疑问的收币金额
  31                          //{ "10. 疑问金额:", 13 },//111024 by cq 删除
  32                          //{ "11. 机器编号: ", 13 },//111024 by cq 删除
  33                          //{ "12.GSM号码:", 11 },//111024 by cq 删除
  34                          //{ "1X. 欠条:", 9 },//111024 by cq 删除
  35                          { "8.欠条:", 7 },//111024 by cq 删除
  36                          //-----------------------------------------------------
  37                  //{ "1X. 小\xca\xfd点:", 11},//111024 by cq 删除
  38                          { "9.小\xca\xfd点:", 9 },//111024 by cq 删除
  39                  { "10. #1纸币:", 11 },
  40                  { "11. #2纸币:", 11 },
  41                  { "12. #3纸币:", 11 },
  42                  { "13. #4纸币:", 11 },
  43                  { "14. #5纸币:", 11 },
  44                  { "15. #6纸币:", 11 },
  45                  { "16. #7纸币:", 11 },
  46                  { "17. #8纸币:", 11 },
  47                  { "18. #1硬币:", 11 },
  48                  { "19. #2硬币:", 11 },
  49                  { "20. #3硬币:", 11 },
  50                  { "21. #4硬币:", 11 },
  51                  { "22. #5硬币:", 11 },
  52                  { "23. #6硬币:", 11 },
  53                  { "24. 开启出货确认:", 17 },
  54                //{ "30. 服务无出货确认:", 19 },
  55                      { "25. 交易时间:", 13 },
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 2   

  56                  { "26. 不找零模式:", 15 },
  57                  { "27. 开启硬币器:", 15 },
  58                  { "28. 开启公交卡:", 15 }, 
  59                  { "29. 读卡时间:",   13 },
  60                  { "30. 暂存纸币模式:",   17 },
  61                  { "31. 五元纸币暂存:",   17 },
  62                  { "32. 十元纸币暂存:",   17 },
  63                  { "33. 开启ACDC模块:",   17 },
  64                  { "34. 开启制冷:",   13 },
  65                  */
  66                  /*
  67                  { "1.开启制冷:",   11 },
  68                  { "2.自动退币:", 11 }, 
  69                  { "3.开启出货确认:", 15 },
  70                  { "4.欠条:", 7 },//111024 by cq 删除 
  71                          { "5.允许多次购买:", 15 },
  72                          { "6.不买货退币:", 13 },
  73                  { "7.余额下限:", 11 },
  74                  { "8.收币上限:", 11 },
  75                          { "9.开启纸币器:", 13 },
  76                  { "10. 开启硬币器:", 15 },        
  77                          { "11. 开启ACDC模块:",   17 },  
  78                          //-----------------------------------------------------
  79                  { "12. 小\xca\xfd点:", 11 },//111024 by cq 删除
  80                  { "13. #1找零面值:", 15 },      
  81                          { "14. #2找零面值:", 15 }, 
  82                  { "15. #1纸币:", 11 },
  83                  { "16. #2纸币:", 11 },
  84                  { "17. #3纸币:", 11 },
  85                  { "18. #4纸币:", 11 },
  86                  { "19. #5纸币:", 11 },
  87                  { "20. #6纸币:", 11 },
  88                  { "21. #7纸币:", 11 },
  89                  { "22. #8纸币:", 11 },
  90                  { "23. #1硬币:", 11 },
  91                  { "24. #2硬币:", 11 },
  92                  { "25. #3硬币:", 11 },
  93                  { "26. #4硬币:", 11 },
  94                  { "27. #5硬币:", 11 },
  95                  { "28. #6硬币:", 11 },
  96                  //{ "29. 不找零模式:", 15 },
  97                  //{ "30. 开启公交卡:", 15 }, 
  98                  //{ "31. 读卡时间:",   13 }, 
  99                  */
 100                  { "1.开启制冷:",   11 },
 101                  { "2.自动退币:", 11 }, 
 102                  { "3.开启出货确认:", 15 },
 103                  { "4.欠条:", 7 },//111024 by cq 删除 
 104                          { "5.允许多次购买:", 15 },
 105                          { "6.不买货退币:", 13 },
 106                  { "7.余额下限:", 11 },
 107                  { "8.开启纸币器:", 13 },
 108                  { "9.开启硬币器:", 13 },        
 109                          { "10. 开启ACDC模块:",   17 },  
 110                          //-----------------------------------------------------
 111                  //{ "11. #1找零面值:", 15 },    
 112                          //{ "12. #2找零面值:", 15 }, 
 113                  { "11. #1纸币:", 11 },
 114                  { "12. #2纸币:", 11 },
 115                  { "13. #3纸币:", 11 },
 116                  { "14. #4纸币:", 11 },
 117                  { "15. #5纸币:", 11 },
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 3   

 118                  { "16. #6纸币:", 11 },
 119                  { "17. #1硬币:", 11 },
 120                  { "18. #2硬币:", 11 },
 121                  { "19. #3硬币:", 11 },
 122                  { "20. #4硬币:", 11 },
 123                  //=====================================================
 124                  };
 125          #else
                      const struct StrAndLen code SysMenustr[] =
                      {               
                              { "1.#1 coin type:", 15 },      
                              { "2.#2 coin type:", 15 },              
                              //{ "3.#3 coin type:", 15 },   //111024 by cq 删除     
                              { "3.Multi-verd:", 13 },//是否允许多次购物              
                              { "4.Refund:", 9 },//是否允许不买货退钱 
                              { "5.Bill on:", 10 },
                              //{ "7.Mobile on:", 12 },
                              { "7.Change value:", 15 },      
                              { "8.Banknote-max:", 15 },      
                              //有疑问的金额
                              //{ "10.Doubtful Amt:", 16 },//111024 by cq 删除
                              //{ "11.VM ID:", 9 },//111024 by cq 删除
                              //{ "12.GSM No.:", 11 },//111024 by cq 删除                             
                              { "8.IOU:", 7 },
                              //-----------------------------------------------------
                              { "9.Decimal num: ", 15 },
                              
                      { "10.#1 Note:", 11 },
                      { "11.#2 Note:", 11 },
                      { "12.#3 Note:", 11 },
                      { "13.#4 Note:", 11 },
                      { "14.#5 Note:", 11 },
                      { "15.#6 Note:", 11 },
                      { "16.#7 Note:", 11 },
                      { "17.#8 Note:", 11 },
                      { "18.#1 Coin:", 11 },
                      { "19.#2 Coin:", 11 },
                      { "20.#3 Coin:", 11 },
                      { "21.#4 Coin:", 11 },
                      { "22.#5 Coin:", 11 },
                      { "23.#6 Coin:", 11 },
                              { "24.GOC_dev on:",  14 },
                        //{ "30.SVC/GOC ERR:", 15 },
                      { "25.Trade time:", 14 },
                      { "26.No change mode:", 18 },        
                      //=====================================================
                      
                      };
              #endif
 167          //const code SysInputLen[] = { 5, 5, 5, 1, 1, 1, 1, 5, 5, 5, 5, 16, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
             - 5, 5, 5, 1, 5, 1, 1, 1, 2, 1, 1, 1, 1 /*, 1*/ };
 168          //                                                        1,,,2,,,,,,,,,,,,,3,,,4,,,5,,,,,,,,,,,,,,6,,,7,,,,,,,,,,,,,,,,,,,,,,,,8,,,9,,10,11,12,13,14,15,
             -16,17,18,19,20,21,,22,,23,24,25,26,27,28,29,,30,31,32,33
 169          const code SysInputLen[] = { 5, 5,/*5,*/ 1, 1, 1, /*1,*/ 5, 5,/* 5, 5, 16,*/ 5, 1, 5, 5, 5, 5, 5, 5, 5, 5,
             - 5, 5, 5, 5, 5, 5, 1, 5, 1, 1, 1, 2, 1, 1, 1, 1 /*, 1*/ };//111024 by cq 删除
 170          bit  data  SystemSave = 0;//系统是否保存
 171          u_char  xdata y_displaystr[44]; //主显示串
 172          //u_char  xdata y_displaystr_1[22];     //备用显示串
 173          //读\写取内存中的系统参数,Num,选中的菜单项编号,len字符串长度,OutInFlag为0时是读,为1时是写
 174          void ReadWriteSysParam( u_char Num,u_char xdata *OutStr,u_char xdata *InStr ,u_char xdata *len, bit OutInF
             -lag )
 175          {       
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 4   

 176   1              u_char  xdata j = 0;    
 177   1              u_char  xdata  i;
 178   1              uint    xdata temp = 0;         
 179   1              uint    xdata tempMoney = 0;    //111129 by cq 缩减代码 
 180   1      
 181   1              i = 0;
 182   1              switch( Num )
 183   1              {
 184   2      
 185   2                      case 0:  //If open compressor module 
 186   2                              if( OutInFlag == 0 )
 187   2                              {                               
 188   3                                      *len = sprintf( OutStr, "%bu", SystemParameter.CompModule );                    
 189   3                              }
 190   2                              else
 191   2                              {
 192   3                                      j = *len;
 193   3                                      if( j == 0 )
 194   3                                              break;
 195   3                                      if( j > 1 )
 196   3                                              j = 1;
 197   3                      //SystemParameter.ACDCModule = 0;
 198   3                                      for( i = 0; i < j; i ++ )
 199   3                                      {
 200   4                                              //111024 by cq 删除
 201   4                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 202   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 203   4                                              {
 204   5                                                      SystemParameter.CompModule = *( InStr + i );
 205   5                                                      break;
 206   5                                              }
 207   4                                      }
 208   3                                      //111024 by cq 删除
 209   3                                      //if( SystemParameter.ACDCModule != 1 )
 210   3                                              //SystemParameter.ACDCModule = 0;       
 211   3                                      SystemSave = 1;
 212   3                              }
 213   2                      break;
 214   2                      case 1:   //Trade time
 215   2                              if( OutInFlag == 0 )
 216   2                              {       
 217   3                                  *len = sprintf( OutStr, "%u", SystemParameter.tradeTime );
 218   3                              }
 219   2                              else
 220   2                              {
 221   3                                      j = *len;
 222   3                                      if( j==0 ) break;
 223   3                                      if( j>5 )  j = 5;
 224   3                                      SystemParameter.tradeTime = 0;
 225   3                                      for( i = 0; i < j; i ++ )
 226   3                                      {
 227   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 228   4                                                      SystemParameter.tradeTime = SystemParameter.tradeTime*10 + *( InStr + i );                                      
 229   4                                      }
 230   3                                      if(SystemParameter.tradeTime >= 255)
 231   3                                      {
 232   4                                              SystemParameter.tradeTime = 255;                                        
 233   4                                      }                               
 234   3                                      SystemSave = 1;
 235   3                              }                       
 236   2                      break;
 237   2                      case 2:  //GOC device on
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 5   

 238   2                              if( OutInFlag == 0 )
 239   2                              {                               
 240   3                                      sprintf( OutStr, "%bu", SystemParameter.GOCOn );                        
 241   3                                      *len = 1;
 242   3                              }
 243   2                              else
 244   2                              {
 245   3                                      j = *len;
 246   3                                      if( j == 0 )
 247   3                                              break;
 248   3                                      if( j > 1 )
 249   3                                              j = 1;
 250   3                                      for( i = 0; i < j; i ++ )
 251   3                                      {
 252   4                                              //111024 by cq 删除
 253   4                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 254   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 255   4                                              {
 256   5                                                      SystemParameter.GOCOn = *( InStr + i );
 257   5                                                      break;
 258   5                                              }
 259   4                                      }
 260   3                                      
 261   3                                      //if( SystemParameter.GOCOn != 1 )
 262   3                                              //SystemParameter.GOCOn = 0;    
 263   3                                      SystemSave = 1;
 264   3                              }
 265   2                      break;
 266   2                      case 3://欠客户的钱
 267   2                              if( OutInFlag == 0 )
 268   2                              {                               
 269   3                                      //如果找零器有多找零情况，显示负数加找零金额;
 270   3                      //如果有欠款，显示欠款金额;by gzz 20110810      
 271   3                      if(SystemParameter.MuchOutFlag==1)
 272   3                      {
 273   4                              switch( SystemParameter.curUnit )
 274   4                                              {
 275   5                                                      case 1:
 276   5                                                              *len = sprintf( OutStr, "-%u", SystemParameter.NotOutMax );
 277   5                                                      break;                          
 278   5                                                      case 10:
 279   5                                                              *len = sprintf( OutStr, "-%u.%u", SystemParameter.NotOutMax/SystemParameter.curUnit,SystemParameter
             -.NotOutMax%SystemParameter.curUnit);
 280   5                                                      break;
 281   5                                                      case 100:
 282   5                                                              *len = sprintf( OutStr, "-%u.%02u", SystemParameter.NotOutMax/SystemParameter.curUnit,SystemParamet
             -er.NotOutMax%SystemParameter.curUnit);
 283   5                                                      break;                                  
 284   5                                              }
 285   4                      }       
 286   3                      else if(SystemParameter.MuchOutFlag==0)
 287   3                      {
 288   4                                              switch( SystemParameter.curUnit )
 289   4                                              {
 290   5                                                      case 1:
 291   5                                                              *len = sprintf( OutStr, "%u", SystemParameter.NotOutMax );
 292   5                                                      break;                          
 293   5                                                      case 10:
 294   5                                                              *len = sprintf( OutStr, "%u.%u", SystemParameter.NotOutMax/SystemParameter.curUnit,SystemParameter.
             -NotOutMax%SystemParameter.curUnit);
 295   5                                                      break;
 296   5                                                      case 100:
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 6   

 297   5                                                              *len = sprintf( OutStr, "%u.%02u", SystemParameter.NotOutMax/SystemParameter.curUnit,SystemParamete
             -r.NotOutMax%SystemParameter.curUnit);
 298   5                                                      break;                                  
 299   5                                              }
 300   4                      }
 301   3                              }
 302   2                              else
 303   2                              {
 304   3                                      j = *len;
 305   3                                      if( j == 0 )
 306   3                                              break;
 307   3                                      if( j > 1 )
 308   3                                              j = 1;                  
 309   3                                      if( *( InStr ) == 0 )                                   
 310   3                                              SystemParameter.NotOutMax = 0;                          
 311   3                                      SystemSave = 1;
 312   3                              }                       
 313   2                      break;
 314   2                      case 4://允许多次购买   
 315   2                              if( OutInFlag == 0 )
 316   2                              {                               
 317   3                                      sprintf( OutStr, "%bu", SystemParameter.IsMuliVerd );                   
 318   3                                      *len = 1;
 319   3                              }
 320   2                              else
 321   2                              {
 322   3                                      j = *len;
 323   3                                      if( j == 0 )
 324   3                                              break;
 325   3                                      if( j > 1 )
 326   3                                              j = 1;
 327   3                                      for( i = 0; i < j; i ++ )
 328   3                                      {
 329   4                                              //111024 by cq 删除
 330   4                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 331   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 332   4                                              {
 333   5                                                      SystemParameter.IsMuliVerd = *( InStr + i );
 334   5                                                      break;
 335   5                                              }
 336   4                                      }
 337   3                                      //111024 by cq 删除
 338   3                                      //if( SystemParameter.IsMuliVerd != 1 )
 339   3                                              //SystemParameter.IsMuliVerd = 0;       
 340   3                                      SystemSave = 1;
 341   3                              }
 342   2                      break;
 343   2                      case 5: //允许退币      
 344   2                              if( OutInFlag == 0 )
 345   2                              {                               
 346   3                                      sprintf( OutStr, "%bu", SystemParameter.RefundPermission );                     
 347   3                                      *len = 1;
 348   3                              }
 349   2                              else
 350   2                              {
 351   3                                      j = *len;
 352   3                                      if( j == 0 )
 353   3                                              break;
 354   3                                      if( j > 1 )
 355   3                                              j = 1;
 356   3                                      for( i = 0; i < j; i ++ )
 357   3                                      {
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 7   

 358   4                                              //111024 by cq 删除
 359   4                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 360   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 361   4                                              {
 362   5                                                      SystemParameter.RefundPermission = *( InStr + i );
 363   5                                                      break;
 364   5                                              }
 365   4                                      }               
 366   3                                      //111024 by cq 删除
 367   3                                      //if( SystemParameter.RefundPermission != 1 )
 368   3                                              //SystemParameter.RefundPermission = 0; 
 369   3                                      SystemSave = 1;
 370   3                              }
 371   2                      break;
 372   2                      case 6://再交易低限额
 373   2                              if( OutInFlag == 0 )
 374   2                              {                               
 375   3                                      switch( SystemParameter.curUnit )
 376   3                                      {
 377   4                                              case 1:
 378   4                                                      *len = sprintf( OutStr, "%u", SystemParameter.Min );
 379   4                                              break;                          
 380   4                                              case 10:
 381   4                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.Min/SystemParameter.curUnit,SystemParameter.Min%Sys
             -temParameter.curUnit);
 382   4                                              break;
 383   4                                              case 100:
 384   4                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.Min/SystemParameter.curUnit,SystemParameter.Min%S
             -ystemParameter.curUnit);
 385   4                                              break;                                  
 386   4                                      }
 387   3                              }
 388   2                              else
 389   2                              {                               
 390   3                                      //Trace( "\n set IP val \n");
 391   3                                      j = *len;                                                                                       
 392   3                                      if( j == 0 )
 393   3                                              break;
 394   3                                      SystemParameter.Min = 0;        
 395   3                                      for( i = 0; i < j; i ++ )
 396   3                                      {
 397   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 398   4                                                      SystemParameter.Min = SystemParameter.Min*10 + *( InStr + i );                                          
 399   4                                      }                       
 400   3                                      SystemSave = 1;
 401   3                              }       
 402   2                      break;                  
 403   2                      case 7://是否允许开启纸币器     
 404   2                              if( OutInFlag == 0 )
 405   2                              {                               
 406   3                                      sprintf( OutStr, "%bu", SystemParameter.BillNo );                       
 407   3                                      *len = 1;
 408   3                              }                       
 409   2                              else
 410   2                              {
 411   3                                      j = *len;
 412   3                                      if( j == 0 )
 413   3                                              break;
 414   3                                      if( j > 1 )
 415   3                                              j = 1;
 416   3                                      for( i = 0; i < j; i ++ )
 417   3                                      {
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 8   

 418   4                                              //111024 by cq 删除
 419   4                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 420   4                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 421   4                                              {
 422   5                                                      SystemParameter.BillNo = *( InStr + i );
 423   5                                                      break;
 424   5                                              }
 425   4                                      }
 426   3      
 427   3                                      if( SystemParameter.BillNo == 0 )
 428   3                                              DeviceStatus.BillAccepter = 128;        
 429   3                                      else
 430   3                                              DeviceStatus.BillAccepter &= 0x7f;      
 431   3                                      
 432   3                                      //111024 by cq 删除
 433   3                                      //if(SystemParameter.BillNo != 1)                                       
 434   3                                              //SystemParameter.BillNo = 0;
 435   3                                      SystemSave = 1;
 436   3                              }                       
 437   2                      break;
 438   2                      case 8:  //Coin acceptor on
 439   2                              if( OutInFlag == 0 )
 440   2                              {                               
 441   3                                      sprintf( OutStr, "%bu", SystemParameter.coinOn );                       
 442   3                                      *len = 1;
 443   3                              }
 444   2                              /*
 445   2                              else
 446   2                              {  
 447   2                                      j = *len;
 448   2                                      if( j == 0 )
 449   2                                              break;
 450   2                                      if( j > 1 )
 451   2                                              j = 1;
 452   2                                      for( i = 0; i < j; i ++ )
 453   2                                      {
 454   2                                              //111024 by cq 删除
 455   2                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 456   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 457   2                                              {
 458   2                                                      SystemParameter.coinOn = *( InStr + i );
 459   2                                                      break;
 460   2                                              }
 461   2                                      }
 462   2      
 463   2                                      if( SystemParameter.coinOn == 0 )
 464   2                                              DeviceStatus.CoinAccepter = 128;  
 465   2                                      else
 466   2                                              DeviceStatus.CoinAccepter &= 0x7f;
 467   2                                              
 468   2                                      //if( SystemParameter.coinOn != 1 )
 469   2                                              //SystemParameter.coinOn = 0;   
 470   2                                      SystemSave = 1;                
 471   2                              }
 472   2                              */
 473   2                      break;
 474   2                      case 9:  //If open ACDC module 
 475   2                              if( OutInFlag == 0 )
 476   2                              {                               
 477   3                                      *len = sprintf( OutStr, "%bu", SystemParameter.ACDCModule );                    
 478   3                              }
 479   2                              /*
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 9   

 480   2                              else
 481   2                              {
 482   2                                      j = *len;
 483   2                                      if( j == 0 )
 484   2                                              break;
 485   2                                      if( j > 1 )
 486   2                                              j = 1;
 487   2                      //SystemParameter.ACDCModule = 0;
 488   2                                      for( i = 0; i < j; i ++ )
 489   2                                      {
 490   2                                              //111024 by cq 删除
 491   2                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 492   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 493   2                                              {
 494   2                                                      SystemParameter.ACDCModule = *( InStr + i );
 495   2                                                      break;
 496   2                                              }
 497   2                                      }
 498   2                                      //111024 by cq 删除
 499   2                                      //if( SystemParameter.ACDCModule != 1 )
 500   2                                              //SystemParameter.ACDCModule = 0;       
 501   2                                      SystemSave = 1;
 502   2                              }
 503   2                              */
 504   2                      break;          
 505   2                      /*
 506   2                      //111024 by cq 删除                     
 507   2                      case 10://#1找零面值                    
 508   2                              if( OutInFlag == 0 )
 509   2                              {                               
 510   2                                      switch( SystemParameter.curUnit )
 511   2                                      {
 512   2                                              case 1:
 513   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.HopperCoinPrice1 );
 514   2                                              break;                          
 515   2                                              case 10:
 516   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.HopperCoinPrice1/SystemParameter.curUnit,SystemPara
             -meter.HopperCoinPrice1%SystemParameter.curUnit );
 517   2                                              break;
 518   2                                              case 100:
 519   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.HopperCoinPrice1/SystemParameter.curUnit,SystemPa
             -rameter.HopperCoinPrice1%SystemParameter.curUnit );
 520   2                                              break;                                  
 521   2                                      }                               
 522   2                              }
 523   2                              else
 524   2                              {       
 525   2                      break;
 526   2                      /*                      
 527   2                                      //Trace( "\n set IP val \n");
 528   2                                      j = *len;                                                                                       
 529   2                                      if( j == 0 )
 530   2                                              break;
 531   2                                      SystemParameter.HopperCoinPrice1 = 0;   
 532   2                                      for( i = 0; i < j; i ++ )
 533   2                                      {
 534   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 535   2                                                      SystemParameter.HopperCoinPrice1 = SystemParameter.HopperCoinPrice1*10 + *( InStr + i );                                                
 536   2                                      }                       
 537   2                                      SystemSave = 1;
 538   2                      * /
 539   2                              }                       
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 10  

 540   2                      break;
 541   2                              
 542   2                      case 11://#2找零面值                    
 543   2                              if( OutInFlag == 0 )
 544   2                              {                                       
 545   2                                      switch( SystemParameter.curUnit )
 546   2                                      {
 547   2                                              case 1:
 548   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.HopperCoinPrice2 );
 549   2                                              break;                          
 550   2                                              case 10:
 551   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.HopperCoinPrice2/SystemParameter.curUnit,SystemPara
             -meter.HopperCoinPrice2%SystemParameter.curUnit );
 552   2                                              break;
 553   2                                              case 100:
 554   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.HopperCoinPrice2/SystemParameter.curUnit,SystemPa
             -rameter.HopperCoinPrice2%SystemParameter.curUnit );
 555   2                                              break;                                  
 556   2                                      }                               
 557   2                              }
 558   2                              else
 559   2                              {
 560   2                      break;
 561   2                      /*                              
 562   2                                      //Trace( "\n set IP val \n");
 563   2                                      j = *len;                                                                                       
 564   2                                      if( j == 0 )
 565   2                                              break;
 566   2                                      SystemParameter.HopperCoinPrice2 = 0;   
 567   2                                      for( i = 0; i < j; i ++ )
 568   2                                      {
 569   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 570   2                                                      SystemParameter.HopperCoinPrice2 = SystemParameter.HopperCoinPrice2*10 + *( InStr + i );                                                
 571   2                                      }                       
 572   2                                      SystemSave = 1;
 573   2                      * /
 574   2                              }                       
 575   2                      break;
 576   2              */
 577   2              
 578   2                      case 10://# 1 note
 579   2                      case 11://# 2 note
 580   2                      case 12://# 3 note
 581   2                      case 13: //# 4 note
 582   2                      case 14: //# 5 note
 583   2                      case 15: //# 6 note
 584   2                      case 16: //# 1 coin
 585   2                      case 17: //# 2 coin
 586   2                      case 18: //# 3 coin
 587   2                      case 19: //# 4 coin
 588   2                              if( OutInFlag == 0 )
 589   2                              {
 590   3                                      
 591   3                                      switch(Num)
 592   3                                              {       
 593   4                                              case 10: //# 1 note
 594   4                                                      tempMoney = SystemParameter.billValue[0];       
 595   4                                                      break;
 596   4                                              case 11: //# 2 note
 597   4                                                      tempMoney = SystemParameter.billValue[1];       
 598   4                                                      break;
 599   4                                              case 12: //# 3 note
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 11  

 600   4                                                      tempMoney = SystemParameter.billValue[2];       
 601   4                                                      break;
 602   4                                              case 13: //# 4 note
 603   4                                                      tempMoney = SystemParameter.billValue[3];       
 604   4                                                      break;
 605   4                                              case 14: //# 5 note
 606   4                                                      tempMoney = SystemParameter.billValue[4];       
 607   4                                                      break;
 608   4                                              case 15: //# 6 note
 609   4                                                      tempMoney = SystemParameter.billValue[5];       
 610   4                                                      break;
 611   4                                                      
 612   4                                              case 16: //# 1 coin
 613   4                                                      tempMoney = SystemParameter.coinValue[0];       
 614   4                                                      break;
 615   4                                              case 17: //# 2 coin
 616   4                                                      tempMoney = SystemParameter.coinValue[1];       
 617   4                                                      break;
 618   4                                              case 18: //# 3 coin
 619   4                                                      tempMoney = SystemParameter.coinValue[2];       
 620   4                                                      break;
 621   4                                              case 19: //# 4 coin
 622   4                                                      tempMoney = SystemParameter.coinValue[3];       
 623   4                                                      break;                                                                                                  
 624   4                                              default:
 625   4                                                      break;
 626   4                                              }
 627   3      
 628   3                                      
 629   3                                      switch( SystemParameter.curUnit )
 630   3                                      {
 631   4                                              case 1:
 632   4                                                      *len = sprintf( OutStr, "%u", tempMoney/100 );
 633   4                                              break;                          
 634   4                                              case 10:
 635   4                                                      *len = sprintf( OutStr, "%u.%u", tempMoney/10/SystemParameter.curUnit,tempMoney/10%SystemParameter.c
             -urUnit );
 636   4                                              break;
 637   4                                              case 100:
 638   4                                                      *len = sprintf( OutStr, "%u.%02u", tempMoney/SystemParameter.curUnit,tempMoney%SystemParameter.curUn
             -it );
 639   4                                              break;                                  
 640   4                                      }               
 641   3                                      
 642   3                              }
 643   2                              /*
 644   2                              else
 645   2                              {                               
 646   2                                      //Trace( "\n set IP val \n");
 647   2                                      j = *len;                                                                                       
 648   2                                      if( j == 0 )
 649   2                                              break;                          
 650   2                                      if( j > 5 )
 651   2                                              j = 5;
 652   2      
 653   2                                      tempMoney = 0;
 654   2                                      //SystemParameter.HopperCoinPrice4 = 0; 
 655   2                                      
 656   2                                      for( i = 0; i < j; i ++ )
 657   2                                      {
 658   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                                        
 659   2                                                      tempMoney = tempMoney*10 + *( InStr + i );
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 12  

 660   2                                                      //SystemParameter.HopperCoinPrice4 = SystemParameter.HopperCoinPrice4*10 + *( InStr + i );                                              
 661   2                                      }       
 662   2      
 663   2                                      switch(Num)
 664   2                                              {                                       
 665   2                                              case 10: //# 1 note
 666   2                                                      SystemParameter.billValue[0] = tempMoney;       
 667   2                                                      break;
 668   2                                              case 11: //# 2 note
 669   2                                                      SystemParameter.billValue[1] = tempMoney;       
 670   2                                                      break;
 671   2                                              case 12: //# 3 note
 672   2                                                      SystemParameter.billValue[2] = tempMoney;       
 673   2                                                      break;
 674   2                                              case 13: //# 4 note
 675   2                                                      SystemParameter.billValue[3] = tempMoney;       
 676   2                                                      break;
 677   2                                              case 14: //# 5 note
 678   2                                                      SystemParameter.billValue[4] = tempMoney;       
 679   2                                                      break;
 680   2                                              case 15: //# 6 note
 681   2                                                      SystemParameter.billValue[5] = tempMoney;       
 682   2                                                      break;                                                  
 683   2                                                      
 684   2                                              case 16: //# 1 coin
 685   2                                                      SystemParameter.coinValue[0] = tempMoney;       
 686   2                                                      break;
 687   2                                              case 17: //# 2 coin
 688   2                                                      SystemParameter.coinValue[1] = tempMoney;       
 689   2                                                      break;
 690   2                                              case 18: //# 3 coin
 691   2                                                      SystemParameter.coinValue[2] = tempMoney;       
 692   2                                                      break;
 693   2                                              case 19: //# 4 coin
 694   2                                                      SystemParameter.coinValue[3] = tempMoney;       
 695   2                                                      break;                                                                                                                  
 696   2                                              default:
 697   2                                                      break;
 698   2                                              }                               
 699   2                                      SystemSave = 1;
 700   2                              }                       
 701   2                              break;  
 702   2                              */
 703   2                              /*
 704   2                      case 28:  //SVC no change
 705   2                              
 706   2                              if( OutInFlag == 0 )
 707   2                              {                               
 708   2                                      sprintf( OutStr, "%bu", SystemParameter.SVC_NoChange );                 
 709   2                                      *len = 1;
 710   2                              }
 711   2                              else
 712   2                              {
 713   2                                      j = *len;
 714   2                                      if( j == 0 )
 715   2                                              break;
 716   2                                      if( j > 1 )
 717   2                                              j = 1;
 718   2                                      for( i = 0; i < j; i ++ )
 719   2                                      {
 720   2                                              //111024 by cq 删除
 721   2                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 13  

 722   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 723   2                                              {
 724   2                                                      SystemParameter.SVC_NoChange = *( InStr + i );
 725   2                                                      break;
 726   2                                              }
 727   2                                      }
 728   2                                      //if( SystemParameter.SVC_NoChange != 1 )
 729   2                                              //SystemParameter.SVC_NoChange = 0;     
 730   2                                      SystemSave = 1;
 731   2                              }
 732   2                      break;
 733   2                      */
 734   2              /*
 735   2              case 29:  //Bus card on
 736   2                      
 737   2                              if( OutInFlag == 0 )
 738   2                              {                               
 739   2                                      sprintf( OutStr, "%bu", SystemParameter.busCardOn );                    
 740   2                                      *len = 1;
 741   2                              }
 742   2                              else
 743   2                              {
 744   2                                      j = *len;
 745   2                                      if( j == 0 )
 746   2                                              break;
 747   2                                      if( j > 1 )
 748   2                                              j = 1;
 749   2                                      for( i = 0; i < j; i ++ )
 750   2                                      {
 751   2                                              //111024 by cq 删除
 752   2                                              //if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 753   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 1 ) )
 754   2                                              {
 755   2                                                      SystemParameter.busCardOn = *( InStr + i );
 756   2                                                      break;
 757   2                                              }
 758   2                                      }
 759   2                                      //if( SystemParameter.busCardOn != 1 )
 760   2                                              //SystemParameter.busCardOn = 0;        
 761   2                                      SystemSave = 1;
 762   2                              }
 763   2                      break;
 764   2                      */
 765   2                              /*
 766   2              case 30:  //bus card read time 
 767   2                      
 768   2                              if( OutInFlag == 0 )
 769   2                              {                               
 770   2                                      *len = sprintf( OutStr, "%bu", SystemParameter.BCReadTime );                    
 771   2                              }
 772   2                              else
 773   2                              {
 774   2                                      j = *len;
 775   2                                      if( j == 0 )
 776   2                                              break;
 777   2                                      if( j > 2 )
 778   2                                              j = 2;
 779   2                      SystemParameter.BCReadTime = 0;
 780   2                                      for( i = 0; i < j; i ++ )
 781   2                                      {
 782   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
 783   2                                              {
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 14  

 784   2                                                      SystemParameter.BCReadTime = SystemParameter.BCReadTime*10 + *( InStr + i );
 785   2                                                      break;
 786   2                                              }
 787   2                                      }
 788   2                                      SystemSave = 1;
 789   2                              }
 790   2                      break;
 791   2                      */
 792   2      
 793   2                       /*             
 794   2                      case 2://#3硬币面值                     
 795   2                              if( OutInFlag == 0 )
 796   2                              {                                                                                                       
 797   2                                      switch( SystemParameter.curUnit )
 798   2                                      {
 799   2                                              case 1:
 800   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.HopperCoinPrice3 );
 801   2                                              break;                          
 802   2                                              case 10:
 803   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.HopperCoinPrice3/SystemParameter.curUnit,SystemPara
             -meter.HopperCoinPrice3%SystemParameter.curUnit );
 804   2                                              break;
 805   2                                              case 100:
 806   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.HopperCoinPrice3/SystemParameter.curUnit,SystemPa
             -rameter.HopperCoinPrice3%SystemParameter.curUnit );
 807   2                                              break;                                  
 808   2                                      }
 809   2                              }
 810   2                              else
 811   2                              {                               
 812   2                                      //Trace( "\n set IP val \n");
 813   2                                      j = *len;                                                                                       
 814   2                                      if( j == 0 )
 815   2                                              break;
 816   2                                      SystemParameter.HopperCoinPrice3 = 0;   
 817   2                                      for( i = 0; i < j; i ++ )
 818   2                                      {
 819   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 820   2                                                      SystemParameter.HopperCoinPrice3 = SystemParameter.HopperCoinPrice3*10 + *( InStr + i );                                                
 821   2                                      }                                                                               
 822   2                                      SystemSave = 1;
 823   2                              }                       
 824   2                      break;  
 825   2                      */
 826   2                      
 827   2                      
 828   2                      
 829   2      //111024 by cq 删除     
 830   2      /*
 831   2                      case 6://是否开启手机模块       
 832   2                              if( OutInFlag == 0 )
 833   2                              {                               
 834   2                                      sprintf( OutStr, "%bu", SystemParameter.MobileON );                     
 835   2                                      *len = 1;
 836   2                              }
 837   2                              else
 838   2                              {
 839   2                                      j = *len;
 840   2                                      if( j == 0 )
 841   2                                              break;
 842   2                                      if( j > 1 )
 843   2                                              j = 1;                          
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 15  

 844   2                                      SystemParameter.MobileON = *( InStr + i );                              
 845   2                                      SystemSave = 1;
 846   2                              }
 847   2                      break;
 848   2      */              
 849   2                      
 850   2                      //111024 by cq 删除
 851   2                      /*
 852   2                      case 9://疑问金额
 853   2                              if( OutInFlag == 0 )
 854   2                              {                               
 855   2                                      switch( SystemParameter.curUnit )
 856   2                                      {
 857   2                                              case 1:
 858   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.DoubtCash );
 859   2                                              break;                          
 860   2                                              case 10:
 861   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.DoubtCash/SystemParameter.curUnit,SystemParameter.D
             -oubtCash%SystemParameter.curUnit);
 862   2                                              break;
 863   2                                              case 100:
 864   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.DoubtCash/SystemParameter.curUnit,SystemParameter
             -.DoubtCash%SystemParameter.curUnit);
 865   2                                              break;                                  
 866   2                                      }
 867   2                              }
 868   2                              else
 869   2                              {
 870   2                                      j = *len;
 871   2                                      if( j == 0 )
 872   2                                              break;
 873   2                                      if( j > 1 )
 874   2                                              j = 1;                  
 875   2                                      if( *( InStr ) == 0 )                                   
 876   2                                              SystemParameter.DoubtCash = 0;                          
 877   2                                      SystemSave = 1;
 878   2                              }                       
 879   2                      break;
 880   2                      case 10://取本机ID号码                          
 881   2                              if(  OutInFlag == 0 )
 882   2                              {
 883   2                                      for( i = 0; i < 5; i++ )
 884   2                                              *len += sprintf( OutStr + i, "%bu", SystemParameter.VmID[i] );
 885   2                              }                       
 886   2                              else//存入
 887   2                              {               
 888   2                                      j = *len;
 889   2                                      memset( SystemParameter.VmID, 0, sizeof( SystemParameter.VmID ) );                              
 890   2                                      for( i = 0; i < j; i ++ )
 891   2                                      {
 892   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 893   2                                                      SystemParameter.VmID[i] = *( InStr + i );                                       
 894   2                                      }
 895   2                                      SystemSave = 1;
 896   2                              }                                               
 897   2                      break;
 898   2                      case 11://GSM模块号码
 899   2                              if( OutInFlag == 0 )
 900   2                              {
 901   2                                      for( i = 0; i < 15; i++ )
 902   2                                      {
 903   2                                              if( SystemParameter.GSMNO[i] != 0xff )
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 16  

 904   2                                              {
 905   2                                                      if( SystemParameter.GSMNO[i] >= 0x10 )
 906   2                                                              *len += sprintf( OutStr + 2*i, "%2bx", SystemParameter.GSMNO[i] );      
 907   2                                                      else
 908   2                                                              *len += sprintf( OutStr + 2*i, "%02bx", SystemParameter.GSMNO[i] );     
 909   2                                                      if( ( SystemParameter.GSMNO[i] & 0x0f ) == 0x0f )
 910   2                                                      {
 911   2                                                              (*len)--;
 912   2                                                              break;
 913   2                                                      }
 914   2                                              }
 915   2                                              else
 916   2                                                      break;                          
 917   2                                      }
 918   2                                      OutStr[(*len)] = 0x00;
 919   2                              }
 920   2                              else
 921   2                              {
 922   2                                      j = *len;
 923   2                                      memset( SystemParameter.GSMNO, 0, sizeof( SystemParameter.GSMNO ) );                            
 924   2                                      for( i = 0; i < j/2; i ++ )                                                                     
 925   2                                              SystemParameter.GSMNO[i] = *( InStr + 2*i ) * 16 + *( InStr + 2*i + 1 );                                
 926   2                                      if( ( j%2 ) == 1 )//奇数个数字          
 927   2                                              SystemParameter.GSMNO[i] = *( InStr + 2*i )*16 + 0x0f;
 928   2                                      i++;
 929   2                                      SystemParameter.GSMNO[i] = 0xff;
 930   2                                      SystemSave = 1;
 931   2                              }
 932   2                      break;
 933   2                      */
 934   2                      
 935   2                      //----------------------------------------------------------------------------------------------------
 936   2                      /*      
 937   2              case 9: //# 1 note
 938   2              if( OutInFlag == 0 )
 939   2                              {                       
 940   2                                      switch( SystemParameter.curUnit )
 941   2                                      {
 942   2                                              case 1:
 943   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[0] );
 944   2                                              break;                          
 945   2                                              case 10:
 946   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[0]/SystemParameter.curUnit,SystemParamete
             -r.billValue[0]%SystemParameter.curUnit );
 947   2                                              break;
 948   2                                              case 100:
 949   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[0]/SystemParameter.curUnit,SystemParame
             -ter.billValue[0]%SystemParameter.curUnit );
 950   2                                              break;                                  
 951   2                                      }                               
 952   2                              }
 953   2                              else
 954   2                              {                               
 955   2                                      //Trace( "\n set IP val \n");
 956   2                                      j = *len;                                                                                       
 957   2                                      if( j == 0 )
 958   2                                              break;
 959   2                                      if( j > 5 )
 960   2                                              j = 5;
 961   2                                      SystemParameter.billValue[0] = 0;       
 962   2                                      for( i = 0; i < j; i ++ )
 963   2                                      {
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 17  

 964   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 965   2                                                      SystemParameter.billValue[0] = SystemParameter.billValue[0]*10 + *( InStr + i );                                                
 966   2                                      }       
 967   2                                      SystemSave = 1;
 968   2                              }                       
 969   2                      break;
 970   2                      case 10: //# 2 note
 971   2              if( OutInFlag == 0 )
 972   2                              {                       
 973   2                                      switch( SystemParameter.curUnit )
 974   2                                      {
 975   2                                              case 1:
 976   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[1] );
 977   2                                              break;                          
 978   2                                              case 10:
 979   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[1]/SystemParameter.curUnit,SystemParamete
             -r.billValue[1]%SystemParameter.curUnit );
 980   2                                              break;
 981   2                                              case 100:
 982   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[1]/SystemParameter.curUnit,SystemParame
             -ter.billValue[1]%SystemParameter.curUnit );
 983   2                                              break;                                  
 984   2                                      }                               
 985   2                              }
 986   2                              else
 987   2                              {                               
 988   2                                      //Trace( "\n set IP val \n");
 989   2                                      j = *len;                                                                                       
 990   2                                      if( j == 0 )
 991   2                                              break;
 992   2                                      if( j > 5 )
 993   2                                              j = 5;
 994   2                                      SystemParameter.billValue[1] = 0;       
 995   2                                      for( i = 0; i < j; i ++ )
 996   2                                      {
 997   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
 998   2                                                      SystemParameter.billValue[1] = SystemParameter.billValue[1]*10 + *( InStr + i );                                                
 999   2                                      }       
1000   2                                      SystemSave = 1;
1001   2                              }                       
1002   2                      break;
1003   2              case 11: //# 3 note
1004   2              if( OutInFlag == 0 )
1005   2                              {                       
1006   2                                      switch( SystemParameter.curUnit )
1007   2                                      {
1008   2                                              case 1:
1009   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[2] );
1010   2                                              break;                          
1011   2                                              case 10:
1012   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[2]/SystemParameter.curUnit,SystemParamete
             -r.billValue[2]%SystemParameter.curUnit );
1013   2                                              break;
1014   2                                              case 100:
1015   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[2]/SystemParameter.curUnit,SystemParame
             -ter.billValue[2]%SystemParameter.curUnit );
1016   2                                              break;                                  
1017   2                                      }                               
1018   2                              }
1019   2                              else
1020   2                              {                               
1021   2                                      //Trace( "\n set IP val \n");
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 18  

1022   2                                      j = *len;                                                                                       
1023   2                                      if( j == 0 )
1024   2                                              break;
1025   2                                      if( j > 5 )
1026   2                                              j = 5;
1027   2                                      SystemParameter.billValue[2] = 0;       
1028   2                                      for( i = 0; i < j; i ++ )
1029   2                                      {
1030   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1031   2                                                      SystemParameter.billValue[2] = SystemParameter.billValue[2]*10 + *( InStr + i );                                                
1032   2                                      }       
1033   2                                      SystemSave = 1;
1034   2                              }                       
1035   2                      break;
1036   2                      case 12: //# 4 note
1037   2              if( OutInFlag == 0 )
1038   2                              {                       
1039   2                                      switch( SystemParameter.curUnit )
1040   2                                      {
1041   2                                              case 1:
1042   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[3] );
1043   2                                              break;                          
1044   2                                              case 10:
1045   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[3]/SystemParameter.curUnit,SystemParamete
             -r.billValue[3]%SystemParameter.curUnit );
1046   2                                              break;
1047   2                                              case 100:
1048   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[3]/SystemParameter.curUnit,SystemParame
             -ter.billValue[3]%SystemParameter.curUnit );
1049   2                                              break;                                  
1050   2                                      }                               
1051   2                              }
1052   2                              else
1053   2                              {                               
1054   2                                      //Trace( "\n set IP val \n");
1055   2                                      j = *len;                                                                                       
1056   2                                      if( j == 0 )
1057   2                                              break;
1058   2                                      if( j > 5 )
1059   2                                              j = 5;
1060   2                                      SystemParameter.billValue[3] = 0;       
1061   2                                      for( i = 0; i < j; i ++ )
1062   2                                      {
1063   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1064   2                                                      SystemParameter.billValue[3] = SystemParameter.billValue[3]*10 + *( InStr + i );                                                
1065   2                                      }       
1066   2                                      SystemSave = 1;
1067   2                              }                       
1068   2                      break;
1069   2              case 13: //# 5 note
1070   2              if( OutInFlag == 0 )
1071   2                              {                       
1072   2                                      switch( SystemParameter.curUnit )
1073   2                                      {
1074   2                                              case 1:
1075   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[4] );
1076   2                                              break;                          
1077   2                                              case 10:
1078   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[4]/SystemParameter.curUnit,SystemParamete
             -r.billValue[4]%SystemParameter.curUnit );
1079   2                                              break;
1080   2                                              case 100:
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 19  

1081   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[4]/SystemParameter.curUnit,SystemParame
             -ter.billValue[4]%SystemParameter.curUnit );
1082   2                                              break;                                  
1083   2                                      }                               
1084   2                              }
1085   2                              else
1086   2                              {                               
1087   2                                      //Trace( "\n set IP val \n");
1088   2                                      j = *len;                                                                                       
1089   2                                      if( j == 0 )
1090   2                                              break;
1091   2                                      if( j > 5 )
1092   2                                              j = 5;
1093   2                                      SystemParameter.billValue[4] = 0;       
1094   2                                      for( i = 0; i < j; i ++ )
1095   2                                      {
1096   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1097   2                                                      SystemParameter.billValue[4] = SystemParameter.billValue[4]*10 + *( InStr + i );                                                
1098   2                                      }       
1099   2                                      SystemSave = 1;
1100   2                              }                       
1101   2                      break;
1102   2              case 14: //# 6 note
1103   2              if( OutInFlag == 0 )
1104   2                              {                       
1105   2                                      switch( SystemParameter.curUnit )
1106   2                                      {
1107   2                                              case 1:
1108   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[5] );
1109   2                                              break;                          
1110   2                                              case 10:
1111   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[5]/SystemParameter.curUnit,SystemParamete
             -r.billValue[5]%SystemParameter.curUnit );
1112   2                                              break;
1113   2                                              case 100:
1114   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[5]/SystemParameter.curUnit,SystemParame
             -ter.billValue[5]%SystemParameter.curUnit );
1115   2                                              break;                                  
1116   2                                      }                               
1117   2                              }
1118   2                              else
1119   2                              {                               
1120   2                                      //Trace( "\n set IP val \n");
1121   2                                      j = *len;                                                                                       
1122   2                                      if( j == 0 )
1123   2                                              break;
1124   2                                      if( j > 5 )
1125   2                                              j = 5;
1126   2                                      SystemParameter.billValue[5] = 0;       
1127   2                                      for( i = 0; i < j; i ++ )
1128   2                                      {
1129   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1130   2                                                      SystemParameter.billValue[5] = SystemParameter.billValue[5]*10 + *( InStr + i );                                                
1131   2                                      }       
1132   2                                      SystemSave = 1;
1133   2                              }                       
1134   2                      break;
1135   2              case 15: //# 7 note
1136   2              if( OutInFlag == 0 )
1137   2                              {                       
1138   2                                      switch( SystemParameter.curUnit )
1139   2                                      {
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 20  

1140   2                                              case 1:
1141   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[6] );
1142   2                                              break;                          
1143   2                                              case 10:
1144   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[6]/SystemParameter.curUnit,SystemParamete
             -r.billValue[6]%SystemParameter.curUnit );
1145   2                                              break;
1146   2                                              case 100:
1147   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[6]/SystemParameter.curUnit,SystemParame
             -ter.billValue[6]%SystemParameter.curUnit );
1148   2                                              break;                                  
1149   2                                      }                               
1150   2                              }
1151   2                              else
1152   2                              {                               
1153   2                                      //Trace( "\n set IP val \n");
1154   2                                      j = *len;                                                                                       
1155   2                                      if( j == 0 )
1156   2                                              break;
1157   2                                      if( j > 5 )
1158   2                                              j = 5;
1159   2                                      SystemParameter.billValue[6] = 0;       
1160   2                                      for( i = 0; i < j; i ++ )
1161   2                                      {
1162   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1163   2                                                      SystemParameter.billValue[6] = SystemParameter.billValue[6]*10 + *( InStr + i );                                                
1164   2                                      }       
1165   2                                      SystemSave = 1;
1166   2                              }                       
1167   2                      break;
1168   2              case 16: //# 8 note
1169   2              if( OutInFlag == 0 )
1170   2                              {                       
1171   2                                      switch( SystemParameter.curUnit )
1172   2                                      {
1173   2                                              case 1:
1174   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.billValue[7] );
1175   2                                              break;                          
1176   2                                              case 10:
1177   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.billValue[7]/SystemParameter.curUnit,SystemParamete
             -r.billValue[7]%SystemParameter.curUnit );
1178   2                                              break;
1179   2                                              case 100:
1180   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.billValue[7]/SystemParameter.curUnit,SystemParame
             -ter.billValue[7]%SystemParameter.curUnit );
1181   2                                              break;                                  
1182   2                                      }                               
1183   2                              }
1184   2                              else
1185   2                              {                               
1186   2                                      //Trace( "\n set IP val \n");
1187   2                                      j = *len;                                                                                       
1188   2                                      if( j == 0 )
1189   2                                              break;
1190   2                                      if( j > 5 )
1191   2                                              j = 5;
1192   2                                      SystemParameter.billValue[7] = 0;       
1193   2                                      for( i = 0; i < j; i ++ )
1194   2                                      {
1195   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1196   2                                                      SystemParameter.billValue[7] = SystemParameter.billValue[7]*10 + *( InStr + i );                                                
1197   2                                      }       
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 21  

1198   2                                      SystemSave = 1;
1199   2                              }                       
1200   2                      break;
1201   2              // Coin value begin with 22
1202   2              case 17: //# 1 coin
1203   2              if( OutInFlag == 0 )
1204   2                              {                       
1205   2                                      switch( SystemParameter.curUnit )
1206   2                                      {
1207   2                                              case 1:
1208   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[0] );
1209   2                                              break;                          
1210   2                                              case 10:
1211   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[0]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[0]%SystemParameter.curUnit );
1212   2                                              break;
1213   2                                              case 100:
1214   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[0]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[0]%SystemParameter.curUnit );
1215   2                                              break;                                  
1216   2                                      }                               
1217   2                              }
1218   2                              else
1219   2                              {                               
1220   2                                      //Trace( "\n set IP val \n");
1221   2                                      j = *len;                                                                                       
1222   2                                      if( j == 0 )
1223   2                                              break;
1224   2                                      if( j > 5 )
1225   2                                              j = 5;
1226   2                                      SystemParameter.coinValue[0] = 0;       
1227   2                                      for( i = 0; i < j; i ++ )
1228   2                                      {
1229   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1230   2                                                      SystemParameter.coinValue[0] = SystemParameter.coinValue[0]*10 + *( InStr + i );                                                
1231   2                                      }       
1232   2                                      SystemSave = 1;
1233   2                              }                       
1234   2                      break;
1235   2                      case 18: //# 2 coin
1236   2              if( OutInFlag == 0 )
1237   2                              {                       
1238   2                                      switch( SystemParameter.curUnit )
1239   2                                      {
1240   2                                              case 1:
1241   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[1] );
1242   2                                              break;                          
1243   2                                              case 10:
1244   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[1]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[1]%SystemParameter.curUnit );
1245   2                                              break;
1246   2                                              case 100:
1247   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[1]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[1]%SystemParameter.curUnit );
1248   2                                              break;                                  
1249   2                                      }                               
1250   2                              }
1251   2                              else
1252   2                              {                               
1253   2                                      //Trace( "\n set IP val \n");
1254   2                                      j = *len;                                                                                       
1255   2                                      if( j == 0 )
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 22  

1256   2                                              break;
1257   2                                      if( j > 5 )
1258   2                                              j = 5;
1259   2                                      SystemParameter.coinValue[1] = 0;       
1260   2                                      for( i = 0; i < j; i ++ )
1261   2                                      {
1262   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1263   2                                                      SystemParameter.coinValue[1] = SystemParameter.coinValue[1]*10 + *( InStr + i );                                                
1264   2                                      }       
1265   2                                      SystemSave = 1;
1266   2                              }                       
1267   2                      break;
1268   2              case 19: //# 3 coin
1269   2              if( OutInFlag == 0 )
1270   2                              {                       
1271   2                                      switch( SystemParameter.curUnit )
1272   2                                      {
1273   2                                              case 1:
1274   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[2] );
1275   2                                              break;                          
1276   2                                              case 10:
1277   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[2]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[2]%SystemParameter.curUnit );
1278   2                                              break;
1279   2                                              case 100:
1280   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[2]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[2]%SystemParameter.curUnit );
1281   2                                              break;                                  
1282   2                                      }                               
1283   2                              }
1284   2                              else
1285   2                              {                               
1286   2                                      //Trace( "\n set IP val \n");
1287   2                                      j = *len;                                                                                       
1288   2                                      if( j == 0 )
1289   2                                              break;
1290   2                                      if( j > 5 )
1291   2                                              j = 5;
1292   2                                      SystemParameter.coinValue[2] = 0;       
1293   2                                      for( i = 0; i < j; i ++ )
1294   2                                      {
1295   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1296   2                                                      SystemParameter.coinValue[2] = SystemParameter.coinValue[2]*10 + *( InStr + i );                                                
1297   2                                      }       
1298   2                                      SystemSave = 1;
1299   2                              }                       
1300   2                      break;
1301   2                      case 20: //# 4 coin
1302   2              if( OutInFlag == 0 )
1303   2                              {                       
1304   2                                      switch( SystemParameter.curUnit )
1305   2                                      {
1306   2                                              case 1:
1307   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[3] );
1308   2                                              break;                          
1309   2                                              case 10:
1310   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[3]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[3]%SystemParameter.curUnit );
1311   2                                              break;
1312   2                                              case 100:
1313   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[3]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[3]%SystemParameter.curUnit );
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 23  

1314   2                                              break;                                  
1315   2                                      }                               
1316   2                              }
1317   2                              else
1318   2                              {                               
1319   2                                      //Trace( "\n set IP val \n");
1320   2                                      j = *len;                                                                                       
1321   2                                      if( j == 0 )
1322   2                                              break;
1323   2                                      if( j > 5 )
1324   2                                              j = 5;
1325   2                                      SystemParameter.coinValue[3] = 0;       
1326   2                                      for( i = 0; i < j; i ++ )
1327   2                                      {
1328   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1329   2                                                      SystemParameter.coinValue[3] = SystemParameter.coinValue[3]*10 + *( InStr + i );                                                
1330   2                                      }       
1331   2                                      SystemSave = 1;
1332   2                              }                       
1333   2                      break;
1334   2              case 21: //# 5 coin
1335   2              if( OutInFlag == 0 )
1336   2                              {                       
1337   2                                      switch( SystemParameter.curUnit )
1338   2                                      {
1339   2                                              case 1:
1340   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[4] );
1341   2                                              break;                          
1342   2                                              case 10:
1343   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[4]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[4]%SystemParameter.curUnit );
1344   2                                              break;
1345   2                                              case 100:
1346   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[4]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[4]%SystemParameter.curUnit );
1347   2                                              break;                                  
1348   2                                      }                               
1349   2                              }
1350   2                              else
1351   2                              {                               
1352   2                                      //Trace( "\n set IP val \n");
1353   2                                      j = *len;                                                                                       
1354   2                                      if( j == 0 )
1355   2                                              break;
1356   2                                      if( j > 5 )
1357   2                                              j = 5;
1358   2                                      SystemParameter.coinValue[4] = 0;       
1359   2                                      for( i = 0; i < j; i ++ )
1360   2                                      {
1361   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1362   2                                                      SystemParameter.coinValue[4] = SystemParameter.coinValue[4]*10 + *( InStr + i );                                                
1363   2                                      }       
1364   2                                      SystemSave = 1;
1365   2                              }                       
1366   2                      break;
1367   2              case 22: //# 6 coin
1368   2              if( OutInFlag == 0 )
1369   2                              {                       
1370   2                                      switch( SystemParameter.curUnit )
1371   2                                      {
1372   2                                              case 1:
1373   2                                                      *len = sprintf( OutStr, "%u", SystemParameter.coinValue[5] );
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 24  

1374   2                                              break;                          
1375   2                                              case 10:
1376   2                                                      *len = sprintf( OutStr, "%u.%u", SystemParameter.coinValue[5]/SystemParameter.curUnit,SystemParamete
             -r.coinValue[5]%SystemParameter.curUnit );
1377   2                                              break;
1378   2                                              case 100:
1379   2                                                      *len = sprintf( OutStr, "%u.%02u", SystemParameter.coinValue[5]/SystemParameter.curUnit,SystemParame
             -ter.coinValue[5]%SystemParameter.curUnit );
1380   2                                              break;                                  
1381   2                                      }                               
1382   2                              }
1383   2                              else
1384   2                              {                               
1385   2                                      //Trace( "\n set IP val \n");
1386   2                                      j = *len;                                                                                       
1387   2                                      if( j == 0 )
1388   2                                              break;
1389   2                                      if( j > 5 )
1390   2                                              j = 5;
1391   2                                      SystemParameter.coinValue[5] = 0;       
1392   2                                      for( i = 0; i < j; i ++ )
1393   2                                      {
1394   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )                                        
1395   2                                                      SystemParameter.coinValue[5] = SystemParameter.coinValue[5]*10 + *( InStr + i );                                                
1396   2                                      }       
1397   2                                      SystemSave = 1;
1398   2                              }                       
1399   2                      break;
1400   2                      */
1401   2                      
1402   2                      /*
1403   2                      case 29:  //If service, when GOC error
1404   2                              if( OutInFlag == 0 )
1405   2                              {                               
1406   2                                      sprintf( OutStr, "%bu", SystemParameter.SVC_GOCErr );                   
1407   2                                      *len = 1;
1408   2                              }
1409   2                              else
1410   2                              {
1411   2                                      j = *len;
1412   2                                      if( j == 0 )
1413   2                                              break;
1414   2                                      if( j > 1 )
1415   2                                              j = 1;
1416   2                                      for( i = 0; i < j; i ++ )
1417   2                                      {
1418   2                                              if( ( *( InStr + i ) >= 0 ) && ( *( InStr + i ) <= 9 ) )
1419   2                                              {
1420   2                                                      SystemParameter.SVC_GOCErr = *( InStr + i );
1421   2                                                      break;
1422   2                                              }
1423   2                                      }
1424   2                                      if( SystemParameter.SVC_GOCErr != 1 )
1425   2                                              SystemParameter.SVC_GOCErr = 0; 
1426   2                                      SystemSave = 1;
1427   2                              }
1428   2                      break;
1429   2                      */              
1430   2              
1431   2                     
1432   2                      
1433   2                      //====================================================================================================
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 25  

1434   2                      default:
1435   2                              break;
1436   2              }
1437   1      }
1438          
1439          /***********************************/
1440          /*y为行号,Num为菜单项序号,flag为是否显示值*/
1441          u_char  DisplayMenuAndVal( u_char y, u_char Num, bit flag )
1442          {       
1443   1              u_char   xdata  len ;
1444   1      
1445   1              len = 0;        
1446   1              memset( y_displaystr,0,sizeof( y_displaystr ) );                                
1447   1              if( flag == 0 )//编辑此项菜单
1448   1              {       
1449   2                      DisplayStr( 0, 0, 1, SysMenustr[Num].str, SysMenustr[Num].len );//显示菜单                      
1450   2                      return 0;
1451   2              }
1452   1              else//显示此项菜单
1453   1              {
1454   2                      memcpy( y_displaystr, SysMenustr[Num].str, SysMenustr[Num].len );//菜单串转化为unicode串                                
1455   2                      ReadWriteSysParam( Num, y_displaystr + SysMenustr[Num].len, 0, &len, 0 );//得到菜单对应的值                             
1456   2                      DisplayStr( 0, y, 1,  y_displaystr, SysMenustr[Num].len + len );//显示菜单
1457   2                      y_displaystr[SysMenustr[Num].len + len ] = '\0';
1458   2                      if( SysMenustr[Num].len + len > 20 )
1459   2                              return ( SysMenustr[Num].len + len - 20) ;              
1460   2                      else
1461   2                              return 0;
1462   2              }
1463   1      }       
1464          
1465          /***********************************/
1466          /*编辑选中项,CardStyle,为选中的卡种类编号,Num为选中的菜单编号,flag标志位,确定是系统参数(0,此时CardStyle无
             -),
1467          还是卡参数(1)*/
1468          bit  EditParam( u_char Num, u_char y )
1469          {
1470   1              u_char  xdata Inputstr[30];
1471   1              u_char  xdata  key;
1472   1              u_char  xdata  Inputlen;        
1473   1              bit     data  ret;
1474   1              
1475   1              key = 0;
1476   1              Inputlen = 0;
1477   1              ret = 0;
1478   1              //Trace( "edit one SysParanMenu begin\n" );
1479   1              
1480   1              Inputlen = SysInputLen[Num];
1481   1              if( ( Num == 0 ) ||( Num == 1 ) ||( Num == 2 ) || ( Num == 7 )|| ( Num == 8 )|| ( Num == 9 ) )
1482   1                      key = GetLineMoney( SysMenustr[Num].str, SysMenustr[Num].len, y, Inputstr, &Inputlen );         
1483   1              else
1484   1                      key = GetLine( SysMenustr[Num].str, SysMenustr[Num].len, y, Inputstr, &Inputlen );      
1485   1              ClearKey();     
1486   1              //Trace( "input END RET (0x) = %bx\n", key );           
1487   1              if( key == 1 )//Enter   
1488   1              {
1489   2                      //Trace( "display select \n" );
1490   2                      DisplayCursorState( 0, 0, 0, 0, 1 );                    
1491   2                      ReadWriteSysParam( Num, 0, Inputstr ,&Inputlen, 1 );
1492   2                      ClearKey();             
1493   2              }               
1494   1              //Trace( "edit one SysParanMenu end\n" );
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 26  

1495   1              return ret;
1496   1      }
1497          
1498          /************************************/
1499          /*光标在菜单中移动或选择,SelectedNum当前光标所在的菜单编号,
1500                  CursorLine，当前光标所覆盖的行,值为1或2,MoveRange,菜单翻动的范围
1501                  SysNum,指显示哪类菜单,1为系统菜单,2为品牌菜单,3为种类菜单,
1502                  ChangeLineflag指定移动光标是否移动菜单项*/
1503          void  SP_MenuSelected( u_char xdata *SelectedNum, u_char xdata *CursorLine, u_char MoveRange, u_char Chang
             -eLineflag )
1504          {
1505   1              u_char xdata  MenuNum = *SelectedNum;
1506   1              //此项为1表示光标在第一行,为二表示光标在第二行
1507   1              u_char xdata  Cursor = *CursorLine;
1508   1              bit        data   flag = 1;     
1509   1              u_char xdata  ReDisplen = 0;
1510   1              u_char xdata  key = 0xff;
1511   1              u_char  xdata  len = 0; 
1512   1      
1513   1              while( flag )
1514   1              {
1515   2                      key = GetKey();
1516   2                      switch( key )           
1517   2                      {
1518   3                              case KEY_CANCEL:
1519   3                                      flag = 0;
1520   3                                      *SelectedNum = 100;                             
1521   3                                      break;
1522   3                              case KEY_UP://上移  
1523   3              //                      Trace("\n Cursor1 = %bu ", Cursor );                            
1524   3              //                      Trace("\n MenuNum1 = %bu ", MenuNum );
1525   3                                      if( Cursor == 2 )//选中标记上移
1526   3                                      {                       
1527   4                                              DisplayCursorState( 0, 0, 1, 2, 1 );//第一行整光标                                      
1528   4                                              Cursor = 1;
1529   4                                              if( ( ChangeLineflag & 0x01 ) == 0x01 )                                 
1530   4                                                      ChangeLineflag |= 0x02;
1531   4                                              else
1532   4                                              {
1533   5                                                      if( MenuNum == 0 )
1534   5                                                              MenuNum = MoveRange;                                    
1535   5                                                      else                                                                        
1536   5                                                              MenuNum--;                                      
1537   5                                              }                                               
1538   4              //                              Trace("\n Cursor2 = %bu ", Cursor );                            
1539   4              //                              Trace("\n MenuNum2 = %bu ", MenuNum );
1540   4                                      }
1541   3                                      else//菜单上翻
1542   3                                      {       
1543   4              //                              Trace("\n Cursor3 = %bu ", Cursor );                            
1544   4              //                              Trace("\n MenuNum3 = %bu ", MenuNum );                                  
1545   4                                      //      DisplayMenuAndVal( 1, MenuNum, 1 );                                     
1546   4                                              if( MenuNum == 0 )
1547   4                                                      MenuNum = MoveRange;                                    
1548   4                                              else                                                                        
1549   4                                                      MenuNum--;                                      
1550   4                                              ReDisplen = DisplayMenuAndVal( 0, MenuNum , 1 );
1551   4                                              if( ReDisplen != 0 )
1552   4                                              {
1553   5                                                      DisplayStr( 0, 1, 1,  y_displaystr + 20, ReDisplen );//显示菜单                                         
1554   5                                                      ReDisplen = 0;
1555   5                                                      DisplayCursorState( 0, Cursor - 1, 1, 2, 1 );//第一行整光标
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 27  

1556   5                                                      if( Cursor == 1 )
1557   5                                                      {
1558   6                                                              //光标目前在第一行，则下移光标不改变菜单选项
1559   6                                                              ChangeLineflag |= 0x02;
1560   6                                                      }
1561   5                                                      else
1562   5                                                      {
1563   6                                                              //光标目前在第二行，则上移光标不改变菜单选项
1564   6                                                              ChangeLineflag |= 0x01;
1565   6                                                      }
1566   5                                              }
1567   4                                              else
1568   4                                              {
1569   5                                                      if(     MenuNum == MoveRange )
1570   5                                                              ReDisplen = DisplayMenuAndVal( 1, 0 , 1 );
1571   5                                                      else
1572   5                                                              ReDisplen = DisplayMenuAndVal( 1, MenuNum + 1 , 1 );
1573   5                                                      DisplayCursorState( 0, Cursor - 1, 1, 2, 1 );//第一行整光标
1574   5                                                      ChangeLineflag = 0;
1575   5                                               //  Cursor = 1;
1576   5                                              }       
1577   4              //                              Trace("\n Cursor4 = %bu ", Cursor );                            
1578   4              //                              Trace("\n MenuNum4 = %bu ", MenuNum );                                                                          
1579   4                                      }
1580   3                                      break;
1581   3                              case KEY_DOWN://下移    
1582   3              //                      Trace("\n Cursor5 = %bu ", Cursor );                            
1583   3              //                      Trace("\n MenuNum5 = %bu ", MenuNum );                                  
1584   3                                      if( Cursor == 1 )//选中标记下移
1585   3                                      {
1586   4                                              DisplayCursorState( 0, 1, 1, 2, 1 );//第二行整光标
1587   4                                              if( ( ChangeLineflag & 0x02 ) == 0x02 )                                 
1588   4                                                      ChangeLineflag |= 0x01;
1589   4                                              else
1590   4                                              {
1591   5                                                      if( MenuNum == MoveRange )
1592   5                                                              MenuNum = 0;                                    
1593   5                                                      else                                                                                                                    
1594   5                                                              MenuNum++;                                   
1595   5                                              }
1596   4                                              Cursor = 2;     
1597   4              //                              Trace("\n Cursor7 = %bu ", Cursor );                            
1598   4              //                              Trace("\n MenuNum7 = %bu ", MenuNum );                                  
1599   4                                      }
1600   3                                      else//菜单下翻
1601   3                                      {       
1602   4                                              if( ChangeLineflag != 0x00 )
1603   4                                              {
1604   5                                                      ChangeLineflag = 0;
1605   5                                                      if( MenuNum == MoveRange )
1606   5                                                              MenuNum = 0;                                    
1607   5                                                      else                    
1608   5                                                              MenuNum++;      
1609   5                              //                 DisplayCursorState( 0, 0, 1, 2, 1 );//第二行整光标
1610   5                              //                 Cursor = 1;
1611   5                                              }
1612   4              //                              Trace("\n Cursor8 = %bu ", Cursor );                            
1613   4              //                              Trace("\n MenuNum8 = %bu ", MenuNum );  
1614   4                                              ReDisplen = DisplayMenuAndVal( 0, MenuNum, 1 );                                                                                                                 
1615   4                                              if( ReDisplen != 0 )
1616   4                                              {
1617   5                                                      DisplayStr( 0, 1, 1,  y_displaystr + 20, ReDisplen );//显示菜单                                         
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 28  

1618   5                                                      ReDisplen = 0;
1619   5                                                      if( Cursor == 1 )
1620   5                                                      {
1621   6                                                              //光标目前在第一行，则下移光标不改变菜单选项
1622   6                                                              ChangeLineflag |= 0x02;
1623   6                                                      }
1624   5                                                      else
1625   5                                                      {
1626   6                                                              //光标目前在第二行，则上移光标不改变菜单选项
1627   6                                                              ChangeLineflag |= 0x01;
1628   6                                                      }
1629   5                                              }
1630   4                                              else
1631   4                                              {                                               
1632   5                                                      if( MenuNum == MoveRange )
1633   5                                                              MenuNum = 0;                                    
1634   5                                                      else                                                                        
1635   5                                                              MenuNum++;      
1636   5                                                      ReDisplen = DisplayMenuAndVal( 1, MenuNum , 1 );                                                                                                                                                                        
1637   5                                              //      Cursor = 2;
1638   5                                              }
1639   4              //                              Trace("\n Cursor9 = %bu ", Cursor );                            
1640   4              //                              Trace("\n MenuNum9 = %bu ", MenuNum );
1641   4                                      }
1642   3                                      break;
1643   3                              case KEY_SUBMIT://Enter,选中了某项菜单
1644   3                                      {                       
1645   4                                              *SelectedNum = MenuNum;
1646   4                                      //      if( ChangeLineflag != 0 )
1647   4                                      //      {
1648   4                                      //              *CursorLine = 1;
1649   4                                      //              DisplayStr( 0, 1, 1,  " ", 20 );//显示菜单
1650   4                                      //      }
1651   4                                      //      else
1652   4                                              *CursorLine = Cursor;                                   
1653   4                                              flag = 0;       
1654   4                                      }
1655   3                                      break;                  
1656   3                      }
1657   2                      CoreProcessCycle();//让出时间片
1658   2                      DelayMs( 5 );
1659   2                      if(sysVPMission.msActTimer == 0)
1660   2                      {
1661   3                              sysVPMission.msActTimer = 100;
1662   3                              VPMission_Act_RPT(VP_ACT_ADMIN,VP_ACT_ENTERADMIN);
1663   3                      }
1664   2              }
1665   1              ClearKey();             
1666   1      }
1667          
1668          /*主控函数*/
1669          bit SysParamManage()            
1670          {
1671   1              u_char  xdata fristNum ;//一级菜单编号
1672   1              u_char  xdata LineNum ;//选中屏幕的行号 
1673   1              u_char xdata  ReDisplen = 0;
1674   1              //bit0为上移光不改变菜单项,bit1为下移光标不改变菜单项
1675   1              u_char xdata  ChangeLineflag = 0;       
1676   1      
1677   1              ClearKey();
1678   1              
1679   1              /*显示两行菜单及其值*/                          
CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 29  

1680   1              DisplayMenuAndVal( 0, 0, 1 );   
1681   1              DisplayMenuAndVal( 1, 1, 1 );           
1682   1              DisplayCursorState( 0, 1, 1, 2, 1 );//设置光标在第二行上且为整行光标状态
1683   1              fristNum = 1;
1684   1              LineNum = 2;    
1685   1              while( 1 )
1686   1              {               
1687   2                      /*判断按下何键*/                        
1688   2                      SP_MenuSelected( &fristNum, &LineNum, MENU_COUNT( SysMenustr ) - 1, ChangeLineflag );                   
1689   2                      //选中了某项菜单                                
1690   2                      if( fristNum == 100 )//选中退出                                                                 
1691   2                              break;          
1692   2                      else//没有选中退出
1693   2                      {                               
1694   3                              ClearKey();                                                                     
1695   3                              EditParam( fristNum, LineNum - 1 );     
1696   3                              //重新显示此项参数的值                  
1697   3                              if( LineNum == 2 )
1698   3                              {                       
1699   4                                      if( fristNum == 0 )
1700   4                                              ReDisplen = DisplayMenuAndVal( 0, MENU_COUNT( SysMenustr ) - 1, 1 );
1701   4                                      else                                            
1702   4                                              ReDisplen = DisplayMenuAndVal( 0, fristNum-1, 1 );                                              
1703   4                                      if( ReDisplen > 0 )
1704   4                                      {
1705   5                                              DisplayStr( 0, 1, 1,  y_displaystr + 20, ReDisplen );//显示菜单                                 
1706   5                                              ReDisplen = 0;
1707   5                                              ChangeLineflag |=0x01;
1708   5                                      }
1709   4                                      else
1710   4                                      {
1711   5                                              ReDisplen = DisplayMenuAndVal( 1, fristNum, 1 );
1712   5                                              if( ReDisplen > 0 )
1713   5                                                      ChangeLineflag = 0;
1714   5                                      }
1715   4                              }
1716   3                              else
1717   3                              {       
1718   4                                      ReDisplen = DisplayMenuAndVal( 0, fristNum, 1 );                                
1719   4                                      if( ReDisplen > 0 )
1720   4                                      {
1721   5                                              DisplayStr( 0, 1, 1,  y_displaystr + 20, ReDisplen );//显示菜单                                 
1722   5                                              ReDisplen = 0;
1723   5                                              ChangeLineflag |=0x02;
1724   5                                      }
1725   4                                      else
1726   4                                      {
1727   5                                              if( fristNum == ( MENU_COUNT( SysMenustr ) - 1 ) )
1728   5                                                      DisplayMenuAndVal( 1, 0, 1 );   
1729   5                                              else                                            
1730   5                                                      DisplayMenuAndVal( 1, fristNum + 1, 1 );        
1731   5                                      }
1732   4                              //      DisplayMenuAndVal( 0, fristNum, 1 );
1733   4                              }                       
1734   3                              DisplayCursorState( 0, LineNum - 1, 1, 2, 1 );//设置光标为整行状态                      
1735   3                      }               
1736   2              }               
1737   1              return 0;
1738   1      }
1739          


CX51 COMPILER V7.50   SYSPARAMSET                                                          10/23/2014 09:48:25 PAGE 30  

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4096    ----
   CONSTANT SIZE    =    443    ----
   XDATA SIZE       =     44      65
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       4
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


CX51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
